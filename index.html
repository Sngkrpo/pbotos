<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ПБОТОС - Сообщить о нарушении</title>
    
    <!-- PWA настройки -->
    <meta name="theme-color" content="#121212">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="ПБОТОС">
    <link rel="manifest" href="manifest.json">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #121212;
            color: white;
            min-height: 100vh;
            padding: 20px;
            line-height: 1.4;
        }

        .container {
            max-width: 100%;
            margin: 0 auto;
        }

        /* СТРАНИЦЫ */
        .page {
            display: none;
            animation: fadeIn 0.3s ease-in-out;
        }

        .page.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* ШАПКИ */
        .header {
            text-align: center;
            padding: 30px 20px;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2rem;
            margin-bottom: 10px;
            color: #ffd200;
        }

        .header p {
            color: #ccc;
            font-size: 1rem;
        }

        /* КНОПКИ И ИКОНКИ */
        .button-grid {
            display: grid;
            gap: 15px;
            margin-bottom: 30px;
        }

        .big-button {
            background: linear-gradient(135deg, #2a2a2a, #1a1a1a);
            border: 2px solid #333;
            border-radius: 20px;
            padding: 25px;
            color: white;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        .big-button:hover {
            transform: translateY(-2px);
            border-color: #ffd200;
            box-shadow: 0 8px 25px rgba(255, 210, 0, 0.2);
        }

        .big-button .icon {
            font-size: 2rem;
        }

        /* ИКОНОЧНЫЕ КНОПКИ */
        .icon-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 30px;
        }

        .icon-button {
            background: linear-gradient(135deg, #2a2a2a, #1a1a1a);
            border: 2px solid #333;
            border-radius: 15px;
            padding: 25px 15px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        .icon-button:hover {
            transform: translateY(-2px);
            border-color: #007bff;
        }

        .icon-button .icon {
            font-size: 2.5rem;
            margin-bottom: 5px;
        }

        .icon-button .text {
            font-size: 0.9rem;
            font-weight: 500;
        }

        /* ГОРИЗОНТАЛЬНЫЙ СКРОЛЛ */
        .scroll-container {
            display: flex;
            gap: 15px;
            overflow-x: auto;
            padding: 10px 5px;
            margin-bottom: 30px;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }

        .scroll-container::-webkit-scrollbar {
            display: none;
        }

        .scroll-item {
            flex: 0 0 auto;
            width: 140px;
            background: linear-gradient(135deg, #2a2a2a, #1a1a1a);
            border: 2px solid #333;
            border-radius: 15px;
            padding: 20px 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .scroll-item:hover {
            border-color: #28a745;
        }

        .scroll-item .icon {
            font-size: 2rem;
            margin-bottom: 8px;
        }

        .scroll-item .text {
            font-size: 0.8rem;
            font-weight: 500;
        }

        /* КРУГЛЫЕ ИКОНКИ */
        .circle-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 30px;
        }

        .circle-button {
            background: linear-gradient(135deg, #2a2a2a, #1a1a1a);
            border: 2px solid #333;
            border-radius: 50%;
            width: 100px;
            height: 100px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 0 auto;
        }

        .circle-button:hover {
            transform: scale(1.05);
            border-color: #dc3545;
        }

        .circle-button .icon {
            font-size: 2rem;
            margin-bottom: 5px;
        }

        .circle-button .text {
            font-size: 0.7rem;
            text-align: center;
            font-weight: 500;
        }

        /* ПОЛЯ ВВОДА */
        .input-group {
            margin-bottom: 25px;
        }

        .input-label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: #ffd200;
            font-size: 1.1rem;
        }

        .text-input, .textarea-input {
            width: 100%;
            background: #2a2a2a;
            border: 2px solid #333;
            border-radius: 12px;
            padding: 15px;
            color: white;
            font-size: 1rem;
            resize: vertical;
        }

        .textarea-input {
            min-height: 120px;
        }

        .text-input:focus, .textarea-input:focus {
            outline: none;
            border-color: #ffd200;
        }

        /* КНОПКИ НАВИГАЦИИ */
        .nav-buttons {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }

        .nav-button {
            flex: 1;
            padding: 16px;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .nav-button.back {
            background: #6c757d;
            color: white;
        }

        .nav-button.next {
            background: #28a745;
            color: white;
        }

        .nav-button.send {
            background: #dc3545;
            color: white;
        }

        .nav-button:hover {
            transform: translateY(-2px);
        }

        /* ПРОГРЕСС БАР */
        .progress-bar {
            width: 100%;
            height: 6px;
            background: #333;
            border-radius: 3px;
            margin: 20px 0;
            overflow: hidden;
        }

        .progress {
            height: 100%;
            background: linear-gradient(90deg, #007bff, #00b3ff);
            width: 0%;
            transition: width 0.4s ease;
        }

        .step-info {
            text-align: center;
            color: #ccc;
            font-size: 0.9rem;
            margin-bottom: 10px;
        }

        /* PWA УСТАНОВКА */
        .install-prompt {
            position: fixed;
            bottom: 20px;
            left: 20px;
            right: 20px;
            background: white;
            color: black;
            padding: 15px;
            border-radius: 12px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.3);
            display: none;
            z-index: 1000;
            text-align: center;
        }

        .install-prompt button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
        }

        /* АДАПТИВНОСТЬ */
        @media (max-width: 480px) {
            body {
                padding: 15px;
            }
            
            .header {
                padding: 20px 15px;
                margin-bottom: 20px;
            }
            
            .header h1 {
                font-size: 1.7rem;
            }
            
            .icon-grid {
                grid-template-columns: 1fr;
                gap: 12px;
            }
            
            .circle-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 12px;
            }
            
            .circle-button {
                width: 90px;
                height: 90px;
            }
            
            .big-button {
                padding: 20px;
                font-size: 1rem;
            }
        }
    </style>
</head>
<body>
    <!-- Окно установки PWA -->
    <div class="install-prompt" id="installPrompt">
        <p><strong>Установите приложение ПБОТОС</strong></p>
        <p>Для быстрого доступа с домашнего экрана</p>
        <button onclick="installApp()">Установить</button>
        <button onclick="dismissPrompt()">Позже</button>
    </div>

    <div class="container">
        <!-- СТРАНИЦА 1: ПРИВЕТСТВИЕ -->
        <div id="pageWelcome" class="page active">
            <div class="header">
                <h1>🚨 ПБОТОС</h1>
                <p>Система оперативного сообщения о нарушениях безопасности</p>
            </div>
            
            <div class="button-grid">
                <button class="big-button" onclick="showPage('pageReport')">
                    <span class="icon">📝</span>
                    НАЧАТЬ
                </button>
            </div>
        </div>

        <!-- СТРАНИЦА 2: ВЫБОР СПОСОБА СООБЩЕНИЯ -->
        <div id="pageReport" class="page">
            <div class="header">
                <h1>Сообщить о нарушении</h1>
                <p>Выберите способ связи</p>
            </div>
            
            <div class="icon-grid">
                <div class="icon-button" onclick="makeCall()">
                    <span class="icon">📞</span>
                    <span class="text">Позвонить</span>
                </div>
                
                <div class="icon-button" onclick="startSteps('sms')">
                    <span class="icon">💬</span>
                    <span class="text">SMS</span>
                </div>
                
                <div class="icon-button" onclick="startSteps('wa')">
                    <span class="icon">💚</span>
                    <span class="text">WhatsApp</span>
                </div>
                
                <div class="icon-button" onclick="startSteps('tg')">
                    <span class="icon">✈️</span>
                    <span class="text">Telegram</span>
                </div>
            </div>
        </div>

        <!-- СТРАНИЦА 3: ВЫБОР ОРГАНИЗАЦИИ -->
        <div id="pageOrganization" class="page">
            <div class="header">
                <h1>Выберите организацию</h1>
                <p>К которой относится нарушивший</p>
            </div>
            
            <div class="step-info" id="step1Info">Шаг 1 из 7</div>
            <div class="progress-bar"><div class="progress" id="progress1"></div></div>
            
            <div class="icon-grid">
                <div class="icon-button" onclick="selectOrganization('АО «Самаранефтегаз»')">
                    <span class="icon">🏢</span>
                    <span class="text">АО «Самаранефтегаз»</span>
                </div>
                
                <div class="icon-button" onclick="selectOrganization('Подрядная организация')">
                    <span class="icon">👷</span>
                    <span class="text">Подрядная организация</span>
                </div>
            </div>
        </div>

        <!-- СТРАНИЦА 4: ВЫБОР ГРУППЫ -->
        <div id="pageGroup" class="page">
            <div class="header">
                <h1>Выберите группу</h1>
            </div>
            
            <div class="step-info" id="step2Info">Шаг 2 из 7</div>
            <div class="progress-bar"><div class="progress" id="progress2"></div></div>
            
            <div class="icon-grid">
                <div class="icon-button" onclick="selectGroup('Южная')">
                    <span class="icon">🧭</span>
                    <span class="text">Южная группа</span>
                </div>
                
                <div class="icon-button" onclick="selectGroup('Центральная')">
                    <span class="icon">🎯</span>
                    <span class="text">Центральная группа</span>
                </div>
                
                <div class="icon-button" onclick="selectGroup('Северная')">
                    <span class="icon">🧊</span>
                    <span class="text">Северная группа</span>
                </div>
                
                <div class="icon-button" onclick="selectGroup('ОДЦ')">
                    <span class="icon">🏛️</span>
                    <span class="text">ОДЦ</span>
                </div>
            </div>
        </div>

        <!-- СТРАНИЦА 5: ВЫБОР УПРАВЛЕНИЯ -->
        <div id="pageManagement" class="page">
            <div class="header">
                <h1>Выберите управление</h1>
            </div>
            
            <div class="step-info" id="step3Info">Шаг 3 из 7</div>
            <div class="progress-bar"><div class="progress" id="progress3"></div></div>
            
            <div class="scroll-container">
                <div class="scroll-item" onclick="selectManagement('УДНГ')">
                    <span class="icon">🛢️</span>
                    <span class="text">УДНГ</span>
                </div>
                
                <div class="scroll-item" onclick="selectManagement('УППН')">
                    <span class="icon">⛽</span>
                    <span class="text">УППН</span>
                </div>
                
                <div class="scroll-item" onclick="selectManagement('УППД')">
                    <span class="icon">🔧</span>
                    <span class="text">УППД</span>
                </div>
                
                <div class="scroll-item" onclick="selectManagement('УПКГ')">
                    <span class="icon">🏭</span>
                    <span class="text">УПКГ</span>
                </div>
                
                <div class="scroll-item" onclick="selectManagement('УЭТ')">
                    <span class="icon">⚡</span>
                    <span class="text">УЭТ</span>
                </div>
                
                <div class="scroll-item" onclick="selectManagement('ПСК')">
                    <span class="icon">🔨</span>
                    <span class="text">ПСК</span>
                </div>
                
                <div class="scroll-item" onclick="selectManagement('УКК')">
                    <span class="icon">🧪</span>
                    <span class="text">УКК</span>
                </div>
                
                <div class="scroll-item" onclick="selectManagement('Блок Энергетика')">
                    <span class="icon">💡</span>
                    <span class="text">Энергетика</span>
                </div>
                
                <div class="scroll-item" onclick="selectManagement('Нет в списке')">
                    <span class="icon">❓</span>
                    <span class="text">Нет в списке</span>
                </div>
                
                <div class="scroll-item" onclick="selectManagement('Не знаю')">
                    <span class="icon">🤷</span>
                    <span class="text">Не знаю</span>
                </div>
            </div>
        </div>

        <!-- СТРАНИЦА 6: ВЫБОР ЦЕХА -->
        <div id="pageShop" class="page">
            <div class="header">
                <h1>Выберите цех/участок</h1>
            </div>
            
            <div class="step-info" id="step4Info">Шаг 4 из 7</div>
            <div class="progress-bar"><div class="progress" id="progress4"></div></div>
            
            <div id="shopContainer">
                <!-- Динамически заполняется цехами -->
            </div>
        </div>

        <!-- СТРАНИЦА 7: ОБЛАСТЬ НАРУШЕНИЯ -->
        <div id="pageArea" class="page">
            <div class="header">
                <h1>Область нарушения</h1>
            </div>
            
            <div class="step-info" id="step5Info">Шаг 5 из 7</div>
            <div class="progress-bar"><div class="progress" id="progress5"></div></div>
            
            <div class="circle-grid">
                <div class="circle-button" onclick="selectArea('СИЗ')">
                    <span class="icon">🛡️</span>
                    <span class="text">СИЗ</span>
                </div>
                
                <div class="circle-button" onclick="selectArea('Инструктаж')">
                    <span class="icon">📋</span>
                    <span class="text">Инструктаж</span>
                </div>
                
                <div class="circle-button" onclick="selectArea('Транспортная безопасность')">
                    <span class="icon">🚗</span>
                    <span class="text">Транспорт</span>
                </div>
                
                <div class="circle-button" onclick="selectArea('Работы повышенной опасности')">
                    <span class="icon">⚠️</span>
                    <span class="text">Опасные работы</span>
                </div>
                
                <div class="circle-button" onclick="selectArea('Пожарная безопасность')">
                    <span class="icon">🔥</span>
                    <span class="text">Пожарная безопасность</span>
                </div>
                
                <div class="circle-button" onclick="selectArea('Передвижение по лестнице')">
                    <span class="icon">📶</span>
                    <span class="text">Лестницы</span>
                </div>
                
                <div class="circle-button" onclick="selectArea('Электробезопасность')">
                    <span class="icon">⚡</span>
                    <span class="text">Электричество</span>
                </div>
            </div>
        </div>

        <!-- СТРАНИЦА 8: МЕСТО НАРУШЕНИЯ -->
        <div id="pagePlace" class="page">
            <div class="header">
                <h1>Место нарушения</h1>
                <p>Укажите где произошло нарушение</p>
            </div>
            
            <div class="step-info" id="step6Info">Шаг 6 из 7</div>
            <div class="progress-bar"><div class="progress" id="progress6"></div></div>
            
            <div class="input-group">
                <label class="input-label">Объект/место нарушения:</label>
                <textarea class="textarea-input" id="placeInput" placeholder="Например: УПН Алакаевская, здание операторной"></textarea>
            </div>
            
            <div class="nav-buttons">
                <button class="nav-button back" onclick="goToStep('pageArea')">Назад</button>
                <button class="nav-button next" onclick="goToStep('pageDescription')">Далее</button>
            </div>
        </div>

        <!-- СТРАНИЦА 9: ОПИСАНИЕ НАРУШЕНИЯ -->
        <div id="pageDescription" class="page">
            <div class="header">
                <h1>Описание нарушения</h1>
                <p>Подробно опишите что произошло</p>
            </div>
            
            <div class="step-info" id="step7Info">Шаг 7 из 7</div>
            <div class="progress-bar"><div class="progress" id="progress7"></div></div>
            
            <div class="input-group">
                <label class="input-label">Что произошло:</label>
                <textarea class="textarea-input" id="descInput" placeholder="Например: Работник передвигался по территории объекта без каски"></textarea>
            </div>
            
            <div class="nav-buttons">
                <button class="nav-button back" onclick="goToStep('pagePlace')">Назад</button>
                <button class="nav-button send" onclick="sendMessage()">Отправить</button>
            </div>
        </div>
    </div>

    <script>
        // Данные для цехов
        const structures = {
            "УДНГ": ["ЦДНГ-2","ЦДНГ-3","ЦДНГ-4","ЦДНГ-5","ЦДНГ-6","ЦДНГ-7","ЦДНГ-8"],
            "УППН": ["ЦППН-1","ЦППН-3","ЦППН-4","ЦППН-5","ЦППН-6"],
            "УППД": ["ЦППД-1","ЦППД-2","ЦППД-3"],
            "УПКГ": ["Участок-1","Участок-2","Участок-3"],
            "УЭТ": ["ЦЭРТ-1","ЦЭРТ-2","ЦЭРТ-3","ЦЛАП"],
            "ПСК": ["ПСЦ-1","ПСЦ-2"],
            "УКК": ["ИХАЛ-1","ИХАЛ-2","ИХАЛ-3","ИХАЛ-4","ИХАЛ-5","ИХАЛ-6","ИХАЛ-7","ИХАЛ-8","ИХАЛ-9"],
            "Блок Энергетика": ["СРЭ","ЦЭОТ-2","ЦЭОТ-3","ЦЭЭ-5","ЦЭЭ-6"]
        };

        // Переменные формы
        let selectedType = "";
        let formData = {
            organization: "",
            group: "",
            management: "",
            shop: "",
            area: "",
            place: "",
            description: ""
        };

        // Навигация по страницам
        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
            window.scrollTo(0, 0);
        }

        function goToStep(pageId) {
            showPage(pageId);
            updateProgress();
        }

        function updateProgress() {
            const steps = {
                'pageOrganization': 1,
                'pageGroup': 2,
                'pageManagement': 3,
                'pageShop': 4,
                'pageArea': 5,
                'pagePlace': 6,
                'pageDescription': 7
            };
            
            const currentPage = document.querySelector('.page.active').id;
            const currentStep = steps[currentPage] || 0;
            
            // Обновляем все прогресс-бары
            for (let i = 1; i <= 7; i++) {
                const progress = document.getElementById(`progress${i}`);
                const info = document.getElementById(`step${i}Info`);
                if (progress) {
                    progress.style.width = i <= currentStep ? '100%' : '0%';
                }
                if (info && i === currentStep) {
                    info.textContent = `Шаг ${i} из 7`;
                }
            }
        }

        // Обработчики выбора
        function startSteps(type) {
            selectedType = type;
            formData = {
                organization: "",
                group: "",
                management: "",
                shop: "",
                area: "",
                place: "",
                description: ""
            };
            goToStep('pageOrganization');
        }

        function selectOrganization(org) {
            formData.organization = org;
            if (org === 'Подрядная организация') {
                // Пропускаем выбор группы и управления для подрядных
                formData.group = "";
                formData.management = "";
                formData.shop = "";
                goToStep('pageArea');
            } else {
                goToStep('pageGroup');
            }
        }

        function selectGroup(group) {
            formData.group = group;
            if (group === 'ОДЦ') {
                // Для ОДЦ пропускаем выбор цеха
                formData.management = "ОДЦ";
                formData.shop = "";
                goToStep('pageArea');
            } else {
                goToStep('pageManagement');
            }
        }

        function selectManagement(management) {
            formData.management = management;
            
            if (management === 'Нет в списке' || management === 'Не знаю') {
                formData.shop = management;
                goToStep('pageArea');
            } else if (structures[management]) {
                showShops(structures[management]);
                goToStep('pageShop');
            } else {
                formData.shop = "";
                goToStep('pageArea');
            }
        }

        function showShops(shops) {
            const container = document.getElementById('shopContainer');
            container.innerHTML = '<div class="icon-grid"></div>';
            const grid = container.querySelector('.icon-grid');
            
            shops.forEach(shop => {
                const button = document.createElement('div');
                button.className = 'icon-button';
                button.onclick = () => {
                    formData.shop = shop;
                    goToStep('pageArea');
                };
                button.innerHTML = `
                    <span class="icon">🏗️</span>
                    <span class="text">${shop}</span>
                `;
                grid.appendChild(button);
            });
        }

        function selectArea(area) {
            formData.area = area;
            goToStep('pagePlace');
        }

        // Отправка сообщения
        function sendMessage() {
            formData.place = document.getElementById('placeInput').value.trim();
            formData.description = document.getElementById('descInput').value.trim();
            
            if (!formData.description) {
                alert('Пожалуйста, опишите нарушение');
                return;
            }

            // Формируем сообщение
            let message = `Сообщение о нарушении:\n\n`;
            message += `Организация: ${formData.organization}\n`;
            
            if (formData.organization === 'АО «Самаранефтегаз»') {
                if (formData.group) message += `Группа: ${formData.group}\n`;
                if (formData.management) message += `Управление: ${formData.management}\n`;
                if (formData.shop) message += `Цех/участок: ${formData.shop}\n`;
            } else {
                // Для подрядных организаций
                if (formData.management) message += `Управление: ${formData.management}\n`;
            }
            
            message += `Область нарушения: ${formData.area}\n`;
            if (formData.place) message += `Место: ${formData.place}\n`;
            message += `\nОписание:\n${formData.description}`;

            // Отправка
            if (selectedType === 'wa') {
                window.open(`https://wa.me/79371809021?text=${encodeURIComponent(message)}`, '_blank');
            } else if (selectedType === 'tg') {
                window.open(`https://t.me/+79371809021?text=${encodeURIComponent(message)}`, '_blank');
            } else if (selectedType === 'sms') {
                window.location.href = `sms:+79371809021?body=${encodeURIComponent(message)}`;
            }
            
            alert('Сообщение подготовлено для отправки!');
            showPage('pageWelcome');
        }

        // Простые функции
        function makeCall() {
            window.open('tel:+79371809021');
        }

        // PWA функциональность
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            setTimeout(() => {
                if (deferredPrompt) document.getElementById('installPrompt').style.display = 'block';
            }, 3000);
        });

        function installApp() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then(() => {
                    deferredPrompt = null;
                    document.getElementById('installPrompt').style.display = 'none';
                });
            }
        }

        function dismissPrompt() {
            document.getElementById('installPrompt').style.display = 'none';
        }

        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('/pbotos-app/sw.js')
                    .catch(error => console.log('SW error:', error));
            });
        }
    </script>
</body>
</html>
